var dt,cols=[];let sheeturl="https://spreadsheets.google.com/feeds/list/1apbJy54knVUXcKpuerSrgkADdZaGJ05Xh3pqkhHZZsI/omakdo1/public/values?alt=json";function getSheet(){fetch(sheeturl).then(res=>res.json()).then(json=>showData(json)).catch(err=>{throw err})}function showData(json){var data=[];console.log(json),json.feed.entry.forEach(entry=>{var row={};for(const[key,value]of Object.entries(entry))0==key.indexOf("gsx")&&(row[key]=value.$t);data.push(row)}),showInfo(data)}var hasComfirmed={};function showInfo(data){document.getElementById("updatetime").innerText!=data[0]["gsx$cậpnhật"]&&(dt=data,document.getElementById("updatetime").innerText=dt[0]["gsx$cậpnhật"],drawTable(),document.getElementById("map").innerHTML="",setMap(),google.charts.setOnLoadCallback(drawGraph))}function drawGraph(){var data=new google.visualization.DataTable;for(data.addColumn("string","Ngày"),data.addColumn("number","Nhiễm"),data.addColumn({type:"number",role:"annotation"}),data.addColumn("number","Chết"),data.addColumn({type:"number",role:"annotation"}),data.addColumn("number","Khỏi"),data.addColumn("number","Mới"),i=0;i<dt.length;i++){var nn=parseInt(dt[i].gsx$confirmed),tv=parseInt(dt[i].gsx$deaths),kb=parseInt(dt[i].gsx$recovered);data.addRows([[dt[i].gsx$date,nn,nn,tv,tv,kb,parseInt(dt[i].gsx$newcases)]])}var options={hAxis:{title:null,textStyle:{color:"#01579b",fontSize:11,fontName:"Arial"},titleTextStyle:{color:"#01579b",fontSize:11,fontName:"Arial",bold:!1,italic:!0},slantedTextAngle:90},vAxis:{title:"Người",textStyle:{color:"#1a237e",fontSize:12,bold:!1},titleTextStyle:{color:"#1a237e",fontSize:11,bold:!1,italic:!1},format:"short"},height:600,annotations:{0:{style:"point"}},chartArea:{left:40,top:10,width:"100%",height:"85%"},colors:["#4285f4","#ea4335","#38761d","#4374e0"],legend:{position:"bottom"},series:{0:{pointSize:6,pointShape:"square"},1:{pointSize:6,pointShape:"diamond"},2:{pointSize:4,pointShape:"circle"},3:{lineDashStyle:[1,1]}}},chart=new google.visualization.LineChart(document.getElementById("chart_div"));google.visualization.events.addListener(chart,"ready",(function(){document.getElementById("imageChart").setAttribute("href",chart.getImageURI()),document.getElementById("imageChart").setAttribute("download",`ncov${document.getElementById("updatetime").innerText}.png`)})),chart.draw(data,options);for(var t=document.getElementsByClassName("toggle"),i=0;i<t.length;i++)t[i].onclick=function(e){toggle(this)},cols.length<4?cols[t[i].getAttribute("col")]=!0:0!=cols[t[i].getAttribute("col")]&&0!=cols[t[i].getAttribute("col")+1]||refreshChart();function toggle(el){var col=parseInt(el.getAttribute("col"));view=new google.visualization.DataView(data),1==cols[col]?(el.innerText=el.innerText.replace("ẨN","HIỆN"),cols[col]=!1):(el.innerText=el.innerText.replace("HIỆN","ẨN"),cols[col]=!0),refreshChart()}function refreshChart(){var setCols=[0,1,3,5,6];cols.forEach((function(c,i){1==c&&setCols.push(i)})),view=new google.visualization.DataView(data),view.setColumns(setCols.sort()),chart.draw(view,options)}}async function drawTable(){var html="",news="";hasComfirmed={};for(var lastData=dt[dt.length-1],i=dt.length-1;i>=0;i--){if(html+="<tr><td>"+dt[i].gsx$date+"</td><td>"+dt[i].gsx$confirmed+" ("+dt[i]["gsx$nhiễm"]+")</td><td>"+dt[i].gsx$deaths+" ("+dt[i]["gsx$chết"]+")</td><td>"+dt[i].gsx$recovered+" ("+dt[i]["gsx$khỏi"]+")</td><td>"+dt[i].gsx$newcases+"</td></tr>",""!=dt[i]["gsx$tỉnhthành"]){var obj={n:dt[i]["gsx$canhiễm"],c:dt[i]["gsx$cachết"],k:dt[i]["gsx$cakhỏi"],opacity:parseInt(dt[i]["gsx$canhiễm"])/parseInt(lastData["gsx$nhiễm"])*255};hasComfirmed[dt[i]["gsx$tỉnhthành"]]=obj}i>1&&""!=dt[i]["gsx$cậpnhật"]&&(news+='<li class="tl-item"><div class="timestamp">'+dt[i].gsx$date+'</div><div class="item-title">'+dt[i]["gsx$cậpnhật"].replace(/\[(.*)\]\((https?:\/\/.*)\)/g,'<a href="$2" target="_blank">$1</a>').replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\~(.*?)\~/g,'<span style="font-weight:bold;color:#ea4335;">$1</span>').replace(/\n/g,"<br>")+"</div></li>")}document.getElementById("world").innerHTML=html,document.getElementById("timeline").innerHTML=news;var activecases=lastData.gsx$confirmed-lastData.gsx$deaths-lastData.gsx$recovered;document.getElementById("activecases").innerHTML='<div class="row"><h3><strong>'+activecases+'</strong><small> người</small></h3></div><div class="row"><div class="one-half column">Nhẹ<h4 style="color:#8080FF;margin-top:0">'+(activecases-lastData.gsx$critical)+'</h4></div> <div class="one-half column">Nghiêm trọng<h4 style="color:#ea4335;margin-top:0">'+lastData.gsx$critical+"</h4></div></div>",document.getElementById("vn-stats").innerHTML='<div class="one-third column">Nhiễm<h4>'+lastData["gsx$nhiễm"]+'</h4></div><div class="one-third column vn-tv">Tử vong<h4>'+lastData["gsx$chết"]+'</h4></div> <div class="one-third column vn-bp">Bình phục<h4>'+lastData["gsx$khỏi"]+"</h4></div>"}document.addEventListener("DOMContentLoaded",getSheet()),google.charts.load("current",{packages:["corechart","line"]}),setInterval(getSheet,6e4);var x=document.createElement("div");x.style.textAlign="center",x.appendChild(document.createTextNode(decodeURIComponent(escape(window.atob("UGjDoXQgdHJp4buDbiBi4bufaSBuaHRAaHV1dGhhbmhkdGQuY29tLiBE4buvIGxp4buHdTogQuG7mSBZIHThur8sIFdvcmxkT01ldGVycw=="))))),document.body.appendChild(x);const url="https://news.google.com/atom/search?q=corona%20when%3A1h&hl=vi&gl=VN&ceid=VN:vi",textarea=document.getElementById("feed");function getFeed(){feednami.load(url).then(feed=>{html="";for(var entries=feed.entries.sort((function(a,b){return new Date(b.date)-new Date(a.date)})),i=0;i<10;i++){var entry=entries[i];if(entry.date){var day=timeago(new Date(entry.date));html+=`<li>${entry.description} <time class="timeago" data="${entry.date}">${day}</time></li>`}else i--}document.getElementById("feed").innerHTML=html,setInterval(updateFeedTime,6e4)})}function updateFeedTime(){for(var x=document.getElementsByClassName("timeago"),i=0;i<x.length;i++)x[i].innerText=timeago(new Date(x[i].getAttribute("data")))}function fbShare(){var winTop=screen.height/2-260,winLeft=screen.width/2-175;return window.open("https://www.facebook.com/sharer/sharer.php?u=https://covid19.ga/","sharer","top="+winTop+",left="+winLeft+",toolbar=0,status=0,width=520,height=350"),!1}function setCookie(cname,cvalue,exdays){var d=new Date;d.setTime(d.getTime()+24*exdays*60*60*1e3);var expires="expires="+d.toUTCString();document.cookie=cname+"="+cvalue+";"+expires+";path=/"}function getCookie(cname){for(var name=cname+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""}function timeago(date){var seconds=Math.floor((new Date-date)/1e3),interval=Math.floor(seconds/31536e3);return interval>1?interval+" năm trước":(interval=Math.floor(seconds/2592e3))>1?interval+" tháng trước":(interval=Math.floor(seconds/86400))>1?interval+" ngày trước":(interval=Math.floor(seconds/3600))>1?interval+" giờ trước":(interval=Math.floor(seconds/60))>1?interval+" phút trước":"vài giây trước"}getFeed();