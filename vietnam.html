
<!DOCTYPE html>
<html>
<head>
<title>CORONA</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<link rel="stylesheet" href="https://s.vnecdn.net/vnexpress/j/v132/event/corona_map/static/css/jquery-jvectormap-2.0.5.css"/>
<script src="https://s.vnecdn.net/vnexpress/j/v132/event/corona_map/static/js/jquery-3.4.1.min.js"></script>
<script src="https://s.vnecdn.net/vnexpress/j/v132/event/corona_map/static/js/jquery-jvectormap-2.0.5.min.js"></script>
<script src="https://s.vnecdn.net/vnexpress/j/v132/event/corona_map/static/js/vietnam_hs_ts.js"></script>
<style>body{margin:0;padding:0;font:400 14px arial}.tip{margin:5px}.tip_title{font-size:14px}.jvectormap-tip{background:#fff;color:#111;-webkit-border-radius:5px;-moz-border-radius:5px;border-radius:5px}.jvectormap-tip p{width:100%;text-align:center}.jvectormap-tip span.tip_nhiembenh,p span.tip_tuvong{background:#111;width:30px;height:30px;display:inline-block;margin:0 5px;-webkit-border-radius:30px;-moz-border-radius:30px;border-radius:30px;color:#fff;line-height:30px;text-align:center;font-weight:bold;font-size:16px}.jvectormap-tip span.tip_nhiembenh{background:#ae2727}.jvectormap-tip .tip p{height:auto;line-height:0}div#note{width:100%;margin:5px}div#note div{width:50%;float:left;line-height:30px}span.cicle{height:16px;width:16px;background:#111;display:inline-block;margin:-2px 5px;-webkit-border-radius:16px;-moz-border-radius:16px;border-radius:16px}span.cicle.congbodich{background:#fb9a56}span.cicle.nhiembenh{background:#ae2727}span.cicle.noidieutri{background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTUuNSA4QzE1LjUgMTIuMTQyMSAxMi4xNDIxIDE1LjUgOCAxNS41QzMuODU3ODYgMTUuNSAwLjUgMTIuMTQyMSAwLjUgOEMwLjUgMy44NTc4NiAzLjg1Nzg2IDAuNSA4IDAuNUMxMi4xNDIxIDAuNSAxNS41IDMuODU3ODYgMTUuNSA4WiIgZmlsbD0id2hpdGUiIHN0cm9rZT0iI0FFMjcyNyIvPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTAuNjY3IDIuNjY2NjdINS4zMzM2NlY1LjMzMzM0TDIuNjY2OTkgNS4zMzMzNEwyLjY2Njk5IDEwLjY2NjdINS4zMzM2NlYxMy4zMzMzSDEwLjY2N1YxMC42NjY3SDEzLjMzMzdWNS4zMzMzNEgxMC42NjdWMi42NjY2N1oiIGZpbGw9IiNBRTI3MjciLz48L3N2Zz4=)}#map{width:100%;height:90vh}.jvectormap-region{stroke:#999;stroke-width:.1}.jvectormap-tip{padding:0}</style>
</head>
<body>
<div id="map"></div>
<div id="note">
<div><span class="cicle congbodich"></span>Nơi có dịch</div>
<div><span class="cicle nhiembenh"></span>Nhiễm bệnh</div>
<div><span class="cicle noidieutri"></span>Nơi điều trị</div>
<div><span class="cicle tuvong"></span>Tử vong</div>
</div>
<script>var csvToJson=function(csv){var lines=csv.split("\n");var result=[];var headers=lines[0].split(",");for(var i=1;i<lines.length;i++){var obj={};var currentline=lines[i].split(",");for(var j=0;j<headers.length;j++){obj[headers[j]]=currentline[j];}result.push(obj);}return result;}
var caseShow=function(cases){if(cases['Nhiễm bệnh']||cases['Tử vong']){var htmlTip='\
			<div class="tip">\
				<p class="tip_title"><strong>'+cases['Tỉnh thành']+'</strong></p>\
				<p><span class="tip_nhiembenh">'+((cases['Nhiễm bệnh'])?cases['Nhiễm bệnh']:0)+'</span>\
				<span class="tip_tuvong">'+((cases['Tử vong'])?cases['Tử vong']:0)+'</span></p>\
			</div>\
			';}else{var htmlTip='\
			<div class="tip">\
				<p class="tip_title"><strong>'+cases['Tỉnh thành']+'</strong></p>\
			</div>\
			';}return htmlTip;}
$.ajax({url:'https://docs.google.com/spreadsheets/d/1EJj1Hob_ZDzuGhn11Eo0Pj8GdBS3L8Y0LeRHfwSgaqg/export?format=csv&id=1EJj1Hob_ZDzuGhn11Eo0Pj8GdBS3L8Y0LeRHfwSgaqg&gid=1291135999',dataType:'text',cache:true}).done(function(csv){var data=csvToJson(csv);var results={};var tipData={};var plants=[];$.each(data,function(k,v){tipData[v.Code]=v;v.Code='id'+(parseInt(v.Code)-1);results[v.Code]=(v['Công bố dịch'])?1:2;if(v['Điều trị'].trim()){var coords=v['Tọa độ'].split('|');plants.push({name:v['Tỉnh thành'],coords:[parseInt(coords[0]),parseInt(coords[1])],status:'published',data:v});}});$('#map').vectorMap({map:'vietnam',backgroundColor:'#aba5a5',color:'#993725',scale:5,zoomOnScroll:(window.location.href.indexOf('#mobile')>-1)?false:true,regionStyle:{selected:{"fill-opacity":1,"fill":'#e86e18',"stroke":'#e86e18'}},markers:plants,series:{regions:[{scale:{1:'#fb9a56',2:'#FFFFFF'},attribute:'fill',values:results}],markers:[{attribute:'image',scale:{'published':'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTUuNSA4QzE1LjUgMTIuMTQyMSAxMi4xNDIxIDE1LjUgOCAxNS41QzMuODU3ODYgMTUuNSAwLjUgMTIuMTQyMSAwLjUgOEMwLjUgMy44NTc4NiAzLjg1Nzg2IDAuNSA4IDAuNUMxMi4xNDIxIDAuNSAxNS41IDMuODU3ODYgMTUuNSA4WiIgZmlsbD0id2hpdGUiIHN0cm9rZT0iI0FFMjcyNyIvPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTAuNjY3IDIuNjY2NjdINS4zMzM2NlY1LjMzMzM0TDIuNjY2OTkgNS4zMzMzNEwyLjY2Njk5IDEwLjY2NjdINS4zMzM2NlYxMy4zMzMzSDEwLjY2N1YxMC42NjY3SDEzLjMzMzdWNS4zMzMzNEgxMC42NjdWMi42NjY2N1oiIGZpbGw9IiNBRTI3MjciLz48L3N2Zz4='},values:plants.reduce(function(p,c,i){p[i]=c.status;return p},{})}]},onRegionTipShow:function(event,label,code){code=parseInt(code.replace('id',''))+1;var cases=tipData[code];if(typeof cases!='undefined'&&code<=63){label.html(caseShow(cases));}else if(code<=88){var htmlTip='\
					<div class="tip">\
						<p class="tip_title"><strong>Quần đảo Trường Sa</strong></p>\
					</div>\
					';label.html(htmlTip);}else if(code<=105){var htmlTip='\
					<div class="tip">\
						<p class="tip_title"><strong>Quần đảo Hoàng Sa</strong></p>\
					</div>\
					';label.html(htmlTip);}},onMarkerTipShow:function(e,label,code){var cases=plants[code]['data'];if(typeof cases!='undefined'){label.html(caseShow(cases));}},onRegionOver:function(evt,code){var bb=mapObj.regions[code].element.shape.getBBox();console.log(bb);}});var mapObj=$("#map").vectorMap('get','mapObject');}).fail(function(k,v){console.log(k,v);});</script>
</body>
</html>
